<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image to Color String Generator</title>
<style>
  body {
    background: #0a0a0a;
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  
  h1 {
    margin-bottom: 10px;
    font-size: 2.5em;
    font-weight: 300;
    text-align: center;
  }
  
  .subtitle {
    color: #888;
    margin-bottom: 30px;
    text-align: center;
  }
  
  .container {
    width: 100%;
    max-width: 1000px;
  }
  
  .section {
    background: #1a1a1a;
    padding: 30px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  
  .upload-area {
    text-align: center;
    padding: 20px;
  }
  
  input[type="file"] {
    padding: 15px 30px;
    background: #2a2a2a;
    border: 2px solid #3a3a3a;
    border-radius: 4px;
    color: #e0e0e0;
    cursor: pointer;
    font-size: 16px;
  }
  
  input[type="file"]:hover {
    background: #3a3a3a;
    border-color: #4a9eff;
  }
  
  .preview-image {
    max-width: 100%;
    max-height: 300px;
    margin: 20px auto;
    display: block;
    border-radius: 8px;
    border: 2px solid #3a3a3a;
  }
  
  .generate-btn {
    width: 100%;
    padding: 20px;
    font-size: 18px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s;
  }
  
  .generate-btn:hover {
    transform: scale(1.02);
  }
  
  .generate-btn:disabled {
    background: #3a3a3a;
    cursor: not-allowed;
    transform: scale(1);
  }
  
  .output-section {
    display: none;
  }
  
  .output-section.visible {
    display: block;
  }
  
  .color-data {
    background: #0a0a0a;
    padding: 15px;
    border-radius: 4px;
    border: 2px solid #3a3a3a;
    margin-top: 20px;
  }
  
  .color-data textarea {
    width: 100%;
    min-height: 150px;
    background: #000;
    color: #4a9eff;
    border: none;
    font-family: monospace;
    font-size: 12px;
    resize: vertical;
    padding: 10px;
    box-sizing: border-box;
  }
  
  .copy-btn {
    margin-top: 10px;
    padding: 10px 20px;
    background: #4a9eff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  
  .copy-btn:hover {
    background: #3a8eef;
  }
  
  .info-text {
    color: #888;
    font-size: 13px;
    margin-top: 10px;
  }
  
  .progress {
    color: #4a9eff;
    font-weight: bold;
    text-align: center;
    margin: 10px 0;
  }
  
  .stats {
    background: #0a0a0a;
    padding: 15px;
    border-radius: 4px;
    border: 2px solid #3a3a3a;
    margin-bottom: 15px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
  }
  
  .stat-item {
    text-align: center;
  }
  
  .stat-label {
    color: #888;
    font-size: 12px;
    margin-bottom: 5px;
  }
  
  .stat-value {
    color: #4a9eff;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¨ Image to Color String</h1>
    <p class="subtitle">Generate color data strings from images for spectrogram visualization</p>
    
    <!-- Upload Section -->
    <div class="section">
      <div class="upload-area">
        <input type="file" id="fileInput" accept="image/*">
        <div class="info-text">Upload an image (JPG, PNG, GIF, etc.)</div>
      </div>
      <img id="preview" class="preview-image" style="display:none;">
    </div>
    
    <!-- Generate Section -->
    <div class="section" id="generateSection" style="display:none;">
      <div class="progress" id="progress" style="display:none;"></div>
      <button class="generate-btn" id="generateBtn">Generate Color String</button>
    </div>
    
    <!-- Output Section -->
    <div class="section output-section" id="outputSection">
      <h3 style="margin-top:0;">Generated Color Data</h3>
      
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">Image Size</div>
          <div class="stat-value" id="imageSizeValue">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Total Pixels</div>
          <div class="stat-value" id="totalPixelsValue">-</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">String Length</div>
          <div class="stat-value" id="stringLengthValue">-</div>
        </div>
      </div>
      
      <div class="color-data">
        <h4>Color Data String</h4>
        <div class="info-text">Copy this string and paste it into your spectrogram viewer</div>
        <textarea id="colorDataTextarea" readonly></textarea>
        <button class="copy-btn" id="copyBtn">ðŸ“‹ Copy to Clipboard</button>
      </div>
    </div>
  </div>

<script>
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');
const generateSection = document.getElementById('generateSection');
const generateBtn = document.getElementById('generateBtn');
const progress = document.getElementById('progress');
const outputSection = document.getElementById('outputSection');
const colorDataTextarea = document.getElementById('colorDataTextarea');
const copyBtn = document.getElementById('copyBtn');
const imageSizeValue = document.getElementById('imageSizeValue');
const totalPixelsValue = document.getElementById('totalPixelsValue');
const stringLengthValue = document.getElementById('stringLengthValue');

let currentImage = null;

// Handle image upload
fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (event) => {
      currentImage = event.target.result;
      preview.src = currentImage;
      preview.style.display = 'block';
      generateSection.style.display = 'block';
      outputSection.classList.remove('visible');
    };
    reader.readAsDataURL(file);
  }
});

// Generate color string
generateBtn.addEventListener('click', async () => {
  if (!currentImage) return;
  
  generateBtn.disabled = true;
  progress.style.display = 'block';
  progress.textContent = 'Processing image...';
  
  try {
    const result = await generateColorString(currentImage);
    
    // Display color data string
    colorDataTextarea.value = result.colorData;
    
    // Update stats
    imageSizeValue.textContent = `${result.width}Ã—${result.height}`;
    totalPixelsValue.textContent = (result.width * result.height).toLocaleString();
    stringLengthValue.textContent = result.colorData.length.toLocaleString();
    
    // Show output
    outputSection.classList.add('visible');
    progress.style.display = 'none';
    
  } catch (error) {
    alert('Error generating color string: ' + error.message);
    progress.style.display = 'none';
  } finally {
    generateBtn.disabled = false;
  }
});

// Copy button
copyBtn.addEventListener('click', () => {
  colorDataTextarea.select();
  document.execCommand('copy');
  copyBtn.textContent = 'âœ… Copied!';
  setTimeout(() => {
    copyBtn.textContent = 'ðŸ“‹ Copy to Clipboard';
  }, 2000);
});

async function generateColorString(imageSrc) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => {
      try {
        progress.textContent = 'Reading image data...';
        
        // Prepare canvas
        const canvas = document.createElement('canvas');
        const maxSize = 600;
        let width = img.width;
        let height = img.height;
        
        // Resize if needed
        if (width > maxSize || height > maxSize) {
          if (width > height) {
            height = Math.floor((height / width) * maxSize);
            width = maxSize;
          } else {
            width = Math.floor((width / height) * maxSize);
            height = maxSize;
          }
        }
        
        // Ensure dimensions are integers
        width = Math.floor(width);
        height = Math.floor(height);
        
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        
        const imageData = ctx.getImageData(0, 0, width, height);
        
        progress.textContent = 'Generating color string...';
        
        // Generate color data string - one column per x position
        const colorData = [];
        
        for (let x = 0; x < width; x++) {
          const colors = [];
          
          // Go through each y position in this column
          for (let y = 0; y < height; y++) {
            const pixelIndex = (y * width + x) * 4;
            const r = imageData.data[pixelIndex];
            const g = imageData.data[pixelIndex + 1];
            const b = imageData.data[pixelIndex + 2];
            colors.push(`${r},${g},${b}`);
          }
          
          colorData.push(colors.join(';'));
          
          // Update progress
          if (x % 10 === 0) {
            const percent = Math.floor((x / width) * 100);
            progress.textContent = `Generating color string... ${percent}%`;
          }
        }
        
        // Create compact color data string
        const colorDataString = `SPEC_V1|${width}x${height}|` + colorData.join('|');
        
        resolve({
          colorData: colorDataString,
          width: width,
          height: height
        });
        
      } catch (error) {
        reject(error);
      }
    };
    img.onerror = () => reject(new Error('Failed to load image'));
    img.src = imageSrc;
  });
}
</script>
</body>
</html>
