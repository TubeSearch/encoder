<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Codec</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            background: #2a2a2a;
            border: none;
            color: #e0e0e0;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .tab.active {
            background: #3a3a3a;
            border-bottom: 3px solid #4CAF50;
        }
        
        .tab:hover {
            background: #333;
        }
        
        .panel {
            display: none;
            background: #2a2a2a;
            padding: 30px;
            border-radius: 8px;
        }
        
        .panel.active {
            display: block;
        }
        
        .upload-area {
            border: 2px dashed #555;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: #4CAF50;
        }
        
        .upload-area.drag-over {
            border-color: #4CAF50;
            background: #333;
        }
        
        input[type="file"] {
            display: none;
        }
        
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        
        .preview {
            margin-top: 20px;
            text-align: center;
        }
        
        .preview img {
            max-width: 100%;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #333;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .fullscreen-btn {
            background: #2196F3;
            margin-top: 10px;
        }
        
        .fullscreen-btn:hover {
            background: #1976D2;
        }
        
        .fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .fullscreen-overlay.active {
            display: flex;
        }
        
        .fullscreen-overlay img {
            max-width: 95vw;
            max-height: 95vh;
            object-fit: contain;
        }
        
        .fullscreen-overlay .close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            background: rgba(0,0,0,0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Encoder/Decoder</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('encode')">Encode</button>
            <button class="tab" onclick="switchTab('decode')">Decode</button>
        </div>
        
        <div id="encode-panel" class="panel active">
            <div class="upload-area" id="encode-drop" onclick="document.getElementById('encode-input').click()">
                <p>Drop an image here or click to upload</p>
                <input type="file" id="encode-input" accept="image/*">
            </div>
            <button id="encode-btn" disabled onclick="encodeImage()">Encode & Download TXT</button>
            <div class="preview" id="encode-preview"></div>
        </div>
        
        <div id="decode-panel" class="panel">
            <div class="upload-area" id="decode-drop" onclick="document.getElementById('decode-input').click()">
                <p>Drop a TXT file here or click to upload</p>
                <input type="file" id="decode-input" accept=".txt">
            </div>
            <button id="decode-btn" disabled onclick="decodeImage()">Decode Image</button>
            <div class="preview" id="decode-preview"></div>
        </div>
    </div>
    
    <div class="fullscreen-overlay" id="fullscreen">
        <span class="close" onclick="closeFullscreen()">&times;</span>
        <img id="fullscreen-img" src="">
    </div>

    <script>
        let encodeFile = null;
        let decodeFile = null;
        let decodedImageData = null;

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            
            if (tab === 'encode') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('encode-panel').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('decode-panel').classList.add('active');
            }
        }

        const encodeInput = document.getElementById('encode-input');
        const encodeDrop = document.getElementById('encode-drop');
        const encodeBtn = document.getElementById('encode-btn');
        const encodePreview = document.getElementById('encode-preview');

        encodeInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                encodeFile = e.target.files[0];
                previewImage(encodeFile, encodePreview);
                encodeBtn.disabled = false;
            }
        });

        encodeDrop.addEventListener('dragover', (e) => {
            e.preventDefault();
            encodeDrop.classList.add('drag-over');
        });

        encodeDrop.addEventListener('dragleave', () => {
            encodeDrop.classList.remove('drag-over');
        });

        encodeDrop.addEventListener('drop', (e) => {
            e.preventDefault();
            encodeDrop.classList.remove('drag-over');
            if (e.dataTransfer.files.length > 0 && e.dataTransfer.files[0].type.startsWith('image/')) {
                encodeFile = e.dataTransfer.files[0];
                previewImage(encodeFile, encodePreview);
                encodeBtn.disabled = false;
            }
        });

        const decodeInput = document.getElementById('decode-input');
        const decodeDrop = document.getElementById('decode-drop');
        const decodeBtn = document.getElementById('decode-btn');
        const decodePreview = document.getElementById('decode-preview');

        decodeInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                decodeFile = e.target.files[0];
                decodeBtn.disabled = false;
            }
        });

        decodeDrop.addEventListener('dragover', (e) => {
            e.preventDefault();
            decodeDrop.classList.add('drag-over');
        });

        decodeDrop.addEventListener('dragleave', () => {
            decodeDrop.classList.remove('drag-over');
        });

        decodeDrop.addEventListener('drop', (e) => {
            e.preventDefault();
            decodeDrop.classList.remove('drag-over');
            if (e.dataTransfer.files.length > 0 && e.dataTransfer.files[0].name.endsWith('.txt')) {
                decodeFile = e.dataTransfer.files[0];
                decodeBtn.disabled = false;
            }
        });

        function previewImage(file, container) {
            const reader = new FileReader();
            reader.onload = (e) => {
                container.innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <div class="info">File: ${file.name} | Size: ${(file.size / 1024).toFixed(2)} KB</div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function encodeImage() {
            if (!encodeFile) return;
            
            encodeBtn.disabled = true;
            encodeBtn.textContent = 'Encoding...';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    
                    // Get PNG data URL (browser does the compression)
                    const dataUrl = canvas.toDataURL('image/png');
                    
                    // Format: IMG|dataurl
                    const encodedData = `IMG|${dataUrl}`;
                    
                    const blob = new Blob([encodedData], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = encodeFile.name.replace(/\.[^/.]+$/, '') + '_encoded.txt';
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    encodeBtn.disabled = false;
                    encodeBtn.textContent = 'Encode & Download TXT';
                    
                    const origSize = encodeFile.size / 1024;
                    const txtSize = blob.size / 1024;
                    const ratio = ((txtSize / origSize) * 100).toFixed(1);
                    
                    const info = document.createElement('div');
                    info.className = 'info';
                    info.style.marginTop = '10px';
                    info.innerHTML = `Encoded!<br>Original: ${origSize.toFixed(2)} KB â†’ TXT: ${txtSize.toFixed(2)} KB (${ratio}% of original)`;
                    encodePreview.appendChild(info);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(encodeFile);
        }

        function decodeImage() {
            if (!decodeFile) return;
            
            decodeBtn.disabled = true;
            decodeBtn.textContent = 'Decoding...';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const text = e.target.result;
                    const parts = text.split('|');
                    
                    if (parts[0] !== 'IMG' || parts.length !== 2) {
                        throw new Error('Invalid format');
                    }
                    
                    decodedImageData = parts[1];
                    
                    const img = new Image();
                    img.onload = () => {
                        decodePreview.innerHTML = `
                            <img src="${decodedImageData}" alt="Decoded">
                            <div class="info">Decoded: ${img.width}x${img.height} pixels</div>
                            <button class="fullscreen-btn" onclick="openFullscreen()">View Fullscreen</button>
                        `;
                        
                        decodeBtn.disabled = false;
                        decodeBtn.textContent = 'Decode Image';
                    };
                    img.src = decodedImageData;
                } catch (err) {
                    alert('Error decoding file: ' + err.message);
                    decodeBtn.disabled = false;
                    decodeBtn.textContent = 'Decode Image';
                }
            };
            reader.readAsText(decodeFile);
        }

        function openFullscreen() {
            if (decodedImageData) {
                document.getElementById('fullscreen-img').src = decodedImageData;
                document.getElementById('fullscreen').classList.add('active');
            }
        }

        function closeFullscreen() {
            document.getElementById('fullscreen').classList.remove('active');
        }

        document.getElementById('fullscreen').addEventListener('click', (e) => {
            if (e.target.id === 'fullscreen') {
                closeFullscreen();
            }
        });
    </script>
</body>
</html>
